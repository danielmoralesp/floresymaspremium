var Section=new Class({Implements:[Events,Options],options:{},initialize:function(t,i){this.setOptions(i),this.root_el=t,this.id=this.root_el.get("id"),this.action_els=this.root_el.getElements("[data-section]"),_.each(this.action_els,function(t){"button"===t.get("tag")&&(t=new Button(t)),t.addEvent("click",function(){this.fireEvent("change_section",t.get("data-section"))}.bind(this))}.bind(this))},show:function(){this.root_el.setStyles({display:"block",opacity:0}).fade("in")},hide:function(t){new Fx.Tween(this.root_el,{duration:"short",link:"chain",property:"opacity",onComplete:function(){this.root_el.setStyle("display","none"),t()}.bind(this)}).start(0)}}),RadioAuthForm=new Class({Implements:Events,$validations:[],formStates:{new_customer:{title_text:"Create Account",user_password_placeholder:"Create Password",submit_button_text:"Create Account",login_form_action:"/users"},returning_customer:{title_text:"Sign In",user_password_placeholder:"Password",submit_button_text:"Sign In",login_form_action:"/users/sign_in"}},initialize:function(t){this.rootEl=t,this.formEl=this.rootEl.getElement("#login_form"),this.forgotPasswordFormEl=this.rootEl.getElement("#forgot_form"),this.titleEl=this.rootEl.getElement("#title"),this.messageEl=this.formEl.getElement("#new_account_message"),this.inputOptions={flashMessage:!1,appendErrors:!0,required:!0},this.emailInput=new EmailInput(this.formEl.getElement("#user_email"),this.inputOptions),this.passwordInput=new PasswordInput(this.formEl.getElement("#user_password"),this.inputOptions),this.submitButton=new Button(this.formEl.getElement("#submit_button")),this.forgotPasswordLinkEl=this.formEl.getElement("#forgot_link"),this.radioButtons=this.formEl.getElements('input[name="customer_type"]'),this.addValidation(this.emailInput.validate.bind(this.emailInput)),this.addValidation(this.passwordInput.validate.bind(this.passwordInput)),this.setupEvents(),this.setInitialState()},setInitialState:function(){var t=this.formEl.getElement('input[name="customer_type"]:checked').get("id");switch(t){case"new_customer":Harrys.user.signedIn()?(this.setState("returning_customer"),this.emailInput.setValue(Harrys.user.email)):this.setState("new_customer");break;case"returning_customer":this.setState("returning_customer")}},setState:function(t){switch(this.titleEl.set("text",this.formStates[t].title_text),this.passwordInput.setPlaceholder(this.formStates[t].user_password_placeholder),this.submitButton.setText(this.formStates[t].submit_button_text),this.formEl.set("action",this.formStates[t].login_form_action),_.find(this.radioButtons,function(i){return i.get("id")===t}).set("checked",!0),t){case"new_customer":this.messageEl.show(),this.forgotPasswordLinkEl.hide();break;case"returning_customer":this.messageEl.hide(),this.forgotPasswordLinkEl.setStyle("display","inline-block")}},setupEvents:function(){this.radioButtons.each(function(t){t.addEvent("click",function(){this.setState(t.get("id"))}.bind(this)),t.addEvent("change",function(){this.setState(t.get("id"))}.bind(this))}.bind(this)),this.forgotPasswordLinkEl.addEvent("click",function(){this.forgotPasswordFormEl.setStyles({opacity:0,display:"block"}).tween("opacity",1),new Fx.Scroll(window).toElement(this.forgotPasswordFormEl),Harrys.analytics.trackPasswordForgot()}.bind(this)),this.formEl.addEvent("submit",function(t){t.preventDefault(),this.validate(function(t){t||this.formEl.submit()}.bind(this))}.bind(this))},validate:function(t){this.$validations.length>0?async.parallel(this.$validations,t):t(null,{success:!0})},addValidation:function(t){this.$validations.push(t)},removeValidations:function(){this.$validations=[]}}),ForgotForm=new Class({$validations:[],initialize:function(t){this.rootEl=t,this.email_input=new EmailInput(this.rootEl.getElement("#user_email"),{flashMessage:!1,appendErrors:!0,required:!0}),this.submitButton=new Button(this.rootEl.getElement("button")),this.$validations.push(this.email_input.validate.bind(this.email_input)),this.rootEl.addEvent("submit",function(t){t.preventDefault(),this.validate(function(t){t||this.rootEl.submit()}.bind(this))}.bind(this))},validate:function(t){this.$validations.length>0?async.parallel(this.$validations,t):t(null,{success:!0})}}),PasswordForm=new Class({$validations:[],initialize:function(t){this.rootEl=t,this.formEl=this.rootEl.getElement("#new_user"),this.passwordInput=new PasswordInput(this.formEl.getElement("#user_password"),{flashMessage:!1,appendErrors:!0,required:!0}),this.submitButton=new Button(this.formEl.getElement("button")),this.$validations.push(this.passwordInput.validate.bind(this.passwordInput)),this.formEl.addEvent("submit",function(t){t.preventDefault(),this.validate(function(t){t||this.formEl.submit()}.bind(this))}.bind(this))},validate:function(t){this.$validations.length>0?async.parallel(this.$validations,t):t(null,{success:!0})}}),Harrys=Harrys||{};window.addEvent("domready",function(){var t=$("auth_form"),i=$("forgot_form"),s=$("password_reset");t&&new RadioAuthForm(t),i&&new ForgotForm(i),s&&new PasswordForm(s)});
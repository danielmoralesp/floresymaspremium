function init(){function t(t){var i=[];_.each(t,function(t){var n,s;switch(t.type){case"validation":var a=t.field.split(".");form=a[0],n=a[1],e(form,n,t.message)||(n=t.field.replace("."," - ").replace(/_/g," ").capitalize(),s="Error: "+n+" "+t.message);break;case"coupon":Harrys.cart.clearCoupon(),s="Error: "+t.message;break;case"global":s="Error: "+t.message;break;case"charge":s="Billing Error: "+t.message;break;default:s="Error: "+t.message}s&&i.push(s)}),_.each(i,function(t){new Flash(t,"error")})}function e(t,e,i){var n,o;switch(t){case"shipping_address":return n=p.fields[e],n?(n.displayError(i),o=s.indexOf(u),a.goToPage(o),!0):!1;case"billing_profile":return n=I.fields[e]||O.fields[e],n?(n.displayError(i),o=s.indexOf(w),a.goToPage(o),!0):!1;default:return!1}}Stripe.setPublishableKey(Harrys.STRIPE_PUBLISHABLE_KEY);var i=new CheckoutOrder,n=_.map($$(BREADCRUMBS_SELECTOR),function(t){var e=new Breadcrumbs(t);return e.addEvent("change",function(t){a.goToPage(t)}),e}),s=_.map($$(PAGES_SELECTOR),function(t,e){var i=new Page(t);return i.addEvent("next",function(){a.nextPage()}),i}),a=new Book(s.length);a.addEvent("change",function(t){_.each(n,function(e){e.activateCrumbEl(t)}),_.each(s,function(t){t.hide()}),s[t].show(),Harrys.analytics.trackCheckoutSection(s[t].name)});var o,r=_.map($$(ADDRESS_FORMS_SELECTOR),function(t){return new AddressForm(t)}),l=_.map($$(PAYMENT_FORMS_SELECTOR),function(t){return new PaymentForm(t)}),d=!1,u=_.findWhere(s,{name:"shipping"}),c=document.getElement(SHIPPING_INFO_SELECTOR);c&&(o=new Radio(c));var h,p=_.findWhere(r,{name:"shipping"}),f=document.getElement(SHIPPING_CLASSES_SELECTOR),m=new ShippingClassRadio(f),g=new AddressNotFoundModal,E=new ProductUnavailableModal,v=new GiftingModal({gift_notecard:Harrys.GIFT_NOTECARD}),b=document.getElements(GIFTING_MODAL_OPEN_SELECTOR),y=document.getElement(GIFTING_SELECTOR),C=new GiftingSection(y),w=_.findWhere(s,{name:"billing"}),S=document.getElement(BILLING_INFO_SELECTOR);S&&(h=new Radio(S));var O=_.findWhere(l,{name:"billing"}),I=_.findWhere(r,{name:"billing"}),x=document.getElement(SHIPPING_AS_BILLING_SELECTOR),R=new ShippingAsBillingRadio(x),T=_.findWhere(s,{name:"review"}),P=document.getElement(CHECKOUT_SUMMARY_SELECTOR),k=new CheckoutSummary(P),L=document.getElement(SHIPPING_DETAILS_SELECTOR),V=new Details(L),A=document.getElement(BILLING_DETAILS_SELECTOR),N=new Details(A),H=document.getElement(PURCHASE_SELECTOR),F=document.getElement(PURCHASE_TOTAL_SELECTOR),D=document.getElement(COUPON_FIELD_SELECTOR),z=new CouponField(D);u.addValidations([function(t){var e=o?o.getValue():"new";"new"===e?p.validate(function(e,i){t(e,i)}):t()},function(t){var e=o?o.getValue():"new";if("new"===e){var i=p.getValue();new SignedRequest.JSON({url:"/api/ShippingAddressService/verifyAddress",method:"get",data:i,onSuccess:function(e){e.success?t():e.data.returned_address?(e.data.returned_address.address_line_1=e.data.returned_address.street1,e.data.returned_address.address_line_2=e.data.returned_address.street2,g.updateOptions({ignore:i,change:e.data.returned_address}).open(function(e,i){e||p.setValue(i.address),t(e,i)})):t()},onFailure:function(e){t()}}).send()}else t()},function(t){var e=o?o.getValue():"new",i="new"===e?p.getValue():_.findWhere(Harrys.SHIPPING_ADDRESSES,{id:e.toInt()}),n=_.reduce(Harrys.cart.cartItems,function(t,e){return e.product.in_stock[i.country]||t.push(e),t},[]);Harrys.cart.getItemCount()===n.length?E.hideContinueEls():E.showContinueEls(),n.length?E.updateCartItems(n).open(t):t()},function(t){var e=o?o.getValue():"new";if("new"===e){var i={shipping_address:p.getValue()};new SignedRequest.JSON({url:"/checkout/shipping_progress",method:"post",data:i,onSuccess:function(e){t(null,{success:!0})},onFailure:function(e){t(null,{success:!0})}}).send()}else t(null,{success:!0})}]),u.addEvent("next",function(){var t=o?o.getValue():"new",e={address:Object.clone("new"===t?p.getValue():_.findWhere(Harrys.SHIPPING_ADDRESSES,{id:t.toInt()})),option:Object.clone(m.getClassData())};R.updateAddress(e.address),V.updateFields(e),Harrys.order.setShipping(e.option.price).setState(e.address.state).setCountry(e.address.country).setZip(e.address.zip).balance()}),o&&(o.addEvent("change",function(){var t=o.getValue(),e=_.findWhere(Harrys.SHIPPING_ADDRESSES,{id:t.toInt()});m.updateOptions(e),_.each($$(NEW_SHIPPING_GROUP_SELECTOR),function(e){"new"===t?e.removeClass("hide").addClass("show"):e.removeClass("show").addClass("hide")})}),o.fireEvent("change")),p.addEvent("change",function(t){var e=p.getValue(),i=["country","zip","state"];_.include(i,t)&&(o&&"new"!==o.getValue()||m.updateOptions(e))}),p.addEvent("po_box_change",function(t){var e=p.getValue();m.updateOptions(e)}),_.each(b,function(t){t.addEvent("click",function(){v.open(function(t,e){t||C.updateFields(e.data).activateGiftView()})})}),m.addEvent("change",function(){var t=Object.clone(m.getClassData());Harrys.order.setShipping(t.price).balance()}),w.addValidations([function(t){var e=h?h.getValue():"new",i="same"===R.getValue();"new"!==e||i||d?t():I.validate(function(e,i){t(e,i)})},function(t){var e=h?h.getValue():"new";"new"!==e||d?t():O.validate(function(e,i){t(e,i)})},function(t){var e=h?h.getValue():"new",i=R.getValue(),n={};"new"!==e||"new"!==i||d?t(null,{success:!0}):(n={billing_address:I.getValue()},new SignedRequest.JSON({url:"/checkout/billing_progress",method:"post",data:n,onSuccess:function(e){t(null,{success:!0})},onFailure:function(e){t(null,{success:!0})}}).send())}]),w.addEvent("next",function(){var t=h?h.getValue():"new",e=R.getValue(),i={};"new"===t&&"new"===e?i.profile=_.extend(Object.clone(I.getValue()),Object.clone(O.getValue())):"new"===t&&"same"===e?i.profile=_.extend(Object.clone(R.getData()),Object.clone(O.getValue())):i.profile=_.findWhere(Harrys.BILLING_PROFILES,{id:t.toInt()}),N.updateFields(i)}),h&&h.addEvent("change",function(){var t=h.getValue();_.each($$(NEW_BILLING_GROUP_SELECTOR),function(e){"new"===t?e.removeClass("hide").addClass("show"):e.removeClass("show").addClass("hide")})}),R.addEvent("change",function(){var t=R.getValue();_.each($$(NEW_BILLING_ADDRESS_GROUP_SELECTOR),function(e){"new"===t?e.removeClass("hide").addClass("show"):e.removeClass("show").addClass("hide")})}),T.addValidation(function(e){_.each(n,function(t){t.disableCrumbEl(0).disableCrumbEl(1)}),V.disableEditEls(),N.disableEditEls();var s={};s.cart={version:Harrys.cart.COOKIE_VERSION,items:_.reduce(Harrys.cart.cartItems,function(t,e,i){return t[i]=e.toHash(),t},{})};var a=Cookie.read(Harrys.cart.COUPON_COOKIE_NAME);a&&(s.cart.coupon_code=a);var r=o?o.getValue():"new";s.shipping_address=Object.clone("new"===r?p.getValue():_.findWhere(Harrys.SHIPPING_ADDRESSES,{id:r.toInt()})),s.shipping_class_id=Object.clone(m.getClassData()).id;var l=h?h.getValue():"new",u=R.getValue(),c=["address_line_1","address_line_2","ccv","city","country","country_full","month","name","state","year","zip","card_number"];"new"===l&&"new"===u?s.billing_profile=_.extend(Object.clone(I.getValue()),Object.clone(O.getValue())):"new"===l&&"same"===u?(s.billing_profile=_.extend(Object.clone(R.getData()),Object.clone(O.getValue())),s.billing_profile=_.reduce(s.billing_profile,function(t,e,i){return _.contains(c,i)&&(t[i]=e),t},{})):s.billing_profile=_.findWhere(Harrys.BILLING_PROFILES,{id:l.toInt()}),s.gift=C.active?C.data:null;var f=/gift\[(.*)\]/;if(s.gift&&(s.gift=_.reduce(s.gift,function(t,e,i){var n=i.match(f);return t[n?n[1]:i]=e,t},{})),i.removeEvents().addEvents({queued:function(){},working:function(){},failed:function(e){_.each(n,function(t){t.enableCrumbEl(0).enableCrumbEl(1)}),V.enableEditEls(),N.enableEditEls(),t(e.errors)},completed:function(t){Cookie.dispose("h_dc"),window.location="/checkout/confirm/"+t}}),s.billing_profile.id||d)i.submit(s);else{var g=new BillingProfile(s);Stripe.card.createToken(g.toStripeFormat(),function(t,e){e.error?i.failed([e.error]):(s.billing_profile={stripe_card_token:e.id},i.submit(s))})}}),V.addEvent("edit",function(){var t=s.indexOf(u);a.goToPage(t)}),N.addEvent("edit",function(){var t=s.indexOf(w);a.goToPage(t)}),z.addEvents({discount_change:function(t){t=t||0,Harrys.order.setDiscount(t).balance();var e=o?o.getValue():"new",i=Object.clone("new"===e?p.getValue():_.findWhere(Harrys.SHIPPING_ADDRESSES,{id:e.toInt()}));m.updateOptions(i)}});var G=document.getElement("[data-base-discount-amount]").get("data-base-discount-amount");G&&Harrys.order.setBaseDiscount(G.toInt()),window.addEvent("scroll",function(){var t=T.root_el,e=t.getCoordinates().top+t.getSize().y,i=window.getScroll().y+window.getSize().y;0!==t.getSize().y&&i>=e?H.setStyles({position:"absolute"}):H.setStyles({position:"fixed"})}),Harrys.order.addEvent("balanced",function(t){function e(t){_.each($$(t),function(t){t.addClass("show").removeClass("hide")})}function i(t){_.each($$(t),function(t){t.addClass("hide").removeClass("show")})}k.update(t),F.set("text",k.numberToCurrency(t.total)),d=0===t.total,d&&!Harrys.cart.containsNonRedemptionSubscriptions()?(e('[data-free-order="show"]'),i('[data-free-order="hide"]')):(i('[data-free-order="show"]'),e('[data-free-order="hide"]'))}),_.each(r,function(t){t.setValue({country:COUNTRY_DEFAULT})}),a.goToPage(STARTING_PAGE_INDEX)}var Harrys=Harrys||{};Harrys.resqueStatus={SQUARE_ONE:"square_one",QUEUED:"queued",WORKING:"working",FAILED:"failed",COMPLETED:"completed",TIMED_OUT:"timed_out"},Harrys.CHECKOUT_POLLING_INTERVAL=1e3;var CheckoutOrder=new Class({Implements:Events,initialize:function(t){this.status=Harrys.resqueStatus.SQUARE_ONE,this.stopped=!1,this.data=t},stop:function(){return this.stopped=!0,this},setData:function(t){return this.data=t||this.data,this},submit:function(t){this.data=t||this.data,this.submitted=moment(),this.request=new SignedRequest.JSON({url:"/checkout/async_submit",data:this.data,method:"post",onSuccess:function(t){this.handleStatus(t)}.bind(this),onFailure:function(){this.failed([{type:"global",message:I18n.t("CheckoutOrder.submit.fail")}])}.bind(this)}),this.request.send()},pollStatus:function(){if(!this.stopped){if(this.request&&this.request.isRunning())return void setTimeout(this.pollStatus.bind(this),Harrys.CHECKOUT_POLLING_INTERVAL);this.request=new SignedRequest.JSON({url:"/checkout/status/"+this.job_id,method:"get",onSuccess:function(t){this.handleStatus(t)}.bind(this),onFailure:function(){setTimeout(this.pollStatus.bind(this),Harrys.CHECKOUT_POLLING_INTERVAL)}.bind(this)}),this.request.send()}},handleStatus:function(t){if(!this.stopped){this.job_id=t.job_id;t.status;switch(t.status){case Harrys.resqueStatus.QUEUED:this.queued();break;case Harrys.resqueStatus.WORKING:this.working();break;case Harrys.resqueStatus.COMPLETED:this.completed(t.order_id);break;case Harrys.resqueStatus.FAILED:this.failed(t.errors);break;default:this.failed([{type:"global",message:I18n.t("CheckoutOrder.handleStatus.fail")}])}}},queued:function(){this.status!=Harrys.resqueStatus.QUEUED&&(this.firstQueued=moment(),this.status=Harrys.resqueStatus.QUEUED,this.fireEvent(Harrys.resqueStatus.QUEUED));var t=moment();return t.unix()>this.firstQueued.unix()+Harrys.CHECKOUT_QUEUE_TIMEOUT?this.timedOut():void setTimeout(this.pollStatus.bind(this),Harrys.CHECKOUT_POLLING_INTERVAL)},working:function(){this.status!=Harrys.resqueStatus.WORKING&&(this.firstWorking=moment(),this.status=Harrys.resqueStatus.WORKING,this.fireEvent(Harrys.resqueStatus.WORKING)),setTimeout(this.pollStatus.bind(this),Harrys.CHECKOUT_POLLING_INTERVAL)},completed:function(t){this.status=Harrys.resqueStatus.COMPLETED,Harrys.cart.clear(),this.fireEvent(Harrys.resqueStatus.COMPLETED,t)},failed:function(t){this.status=Harrys.resqueStatus.FAILED,this.fireEvent(Harrys.resqueStatus.FAILED,{errors:t})},timedOut:function(){var t=new SignedRequest.JSON({url:"/checkout/cancel/"+this.job_id,method:"post",onComplete:function(t){this.failed([{type:"global",message:I18n.t("CheckoutOrder.timedOut.fail")}])}.bind(this)});t.send()}}),BillingProfile=new Class({initialize:function(t){this.data=t},toStripeFormat:function(){var t=this.data.billing_profile;return{number:t.card_number,cvc:t.ccv.replace(/\D+/,""),exp_month:t.month,exp_year:t.year,name:t.name,address_line1:t.address_line_1,address_line2:t.address_line_2,address_city:t.city,address_state:t.state,address_zip:t.zip,address_country:t.country}}}),Breadcrumbs=new Class({Implements:[Events,Options],options:{crumb_selector:"[data-crumb]",disable_crumbs:!0,disabled_class:"disabled",active_class:"active",starting_crumb_index:0},initialize:function(t,e){this.setOptions(e),this.root_el=t,this.crumb_els=this.root_el.getElements(this.options.crumb_selector),this.activateCrumbEl(this.options.starting_crumb_index)},activateCrumbEl:function(t){if(t>=this.crumb_els.length)throw new Error("Index not in range");return _.each(this.crumb_els,function(e,i,n){e.removeClass(this.options.active_class),this[i>=t&&this.options.disable_crumbs?"disableCrumbEl":"enableCrumbEl"](i)}.bind(this)),this.crumb_els[t].addClass(this.options.active_class),this},enableCrumbEl:function(t){return this.crumb_els[t].removeClass(this.options.disabled_class).addEvent("click",function(){this.fireEvent("change",t)}.bind(this)),this},disableCrumbEl:function(t){return this.crumb_els[t].addClass(this.options.disabled_class).removeEvents("click"),this}}),Validations=new Class({$validations:[],validate:function(t,e){e=e||"parallel",this.$validations.length>0?async[e](this.$validations,function(e,i){e?this._onInvalid(e,i,t):this._onValid(e,i,t)}.bind(this)):this._onValid(null,{success:!0},t)},addValidation:function(t){return-1===this._getIndexByValidation(t)&&this.$validations.push(t),this},addValidations:function(t){return _.each(t,this.addValidation.bind(this)),this},removeValidation:function(t){var e=this._getIndexByValidation(t);return this.$validations.splice(e,1),this},removeValidations:function(){return this.$validations=[],this},_getIndexByValidation:function(t){return this.$validations.indexOf(t)},_onValid:function(t,e,i){_.isFunction(i)&&i(t,e)},_onInvalid:function(t,e,i){_.isFunction(i)&&i(t)}}),Page=new Class({Implements:[Events,Options,Validations],options:{next_action_selector:"[data-page-action='next']",button_loading_text:"Loading",name_attribute:"data-page",show_class_name:"show",hide_class_name:"hide"},initialize:function(t,e){this.setOptions(e),this.root_el=t,this.name=this.root_el.get(this.options.name_attribute),this.next_action_triggers=this._setupNextActionTriggers()},next:function(t){this.validate(function(e){e?this._handleValidationError(e):this.fireEvent("next"),t&&t(e)}.bind(this),"series")},show:function(){this.root_el.addClass(this.options.show_class_name).removeClass(this.options.hide_class_name);var t=new Fx.Scroll(window);return t.toTop(),this},hide:function(){return this.root_el.addClass(this.options.hide_class_name).removeClass(this.options.show_class_name),this},_setupNextActionTriggers:function(){var t=this.root_el.getElements(this.options.next_action_selector);return _.map(t,function(t){var e="button"===t.get("tag")||t.hasClass("button"),i=e?new Button(t):t;return i.addEvent("click",function(){e&&i.disable(this.options.button_loading_text),this.next(function(){e&&i.enable()})}.bind(this)),i}.bind(this))},_handleValidationError:function(t){return new Flash(t),this}}),Book=new Class({Implements:[Events,Options],current_index:null,initialize:function(t,e){this.setOptions(e),this.max_index=t},nextPage:function(){var t=this.current_index+1;return t>=this.max_index||0>t?!1:void this.goToPage(t)},goToPage:function(t){this.current_index=t,this.fireEvent("change",t)}});/*!
	Autosize 3.0.5
	license: MIT
	http://www.jacklmoore.com/autosize
*/
!function(t,e){if("function"==typeof define&&define.amd)define(["exports","module"],e);else if("undefined"!=typeof exports&&"undefined"!=typeof module)e(exports,module);else{var i={exports:{}};e(i.exports,i),t.autosize=i.exports}}(this,function(t,e){"use strict";function i(t){function e(){var e=window.getComputedStyle(t,null);"vertical"===e.resize?t.style.resize="none":"both"===e.resize&&(t.style.resize="horizontal"),d="content-box"===e.boxSizing?-(parseFloat(e.paddingTop)+parseFloat(e.paddingBottom)):parseFloat(e.borderTopWidth)+parseFloat(e.borderBottomWidth),n()}function i(e){var i=t.style.width;t.style.width="0px",t.offsetWidth,t.style.width=i,u=e,l&&(t.style.overflowY=e),n()}function n(){var e=t.style.height,n=document.documentElement.scrollTop,s=document.body.scrollTop,a=t.style.height;t.style.height="auto";var o=t.scrollHeight+d;if(0===t.scrollHeight)return void(t.style.height=a);t.style.height=o+"px",document.documentElement.scrollTop=n,document.body.scrollTop=s;var r=window.getComputedStyle(t,null);if(r.height!==t.style.height){if("visible"!==u)return void i("visible")}else if("hidden"!==u)return void i("hidden");if(e!==t.style.height){var l=document.createEvent("Event");l.initEvent("autosize:resized",!0,!1),t.dispatchEvent(l)}}var s=void 0===arguments[1]?{}:arguments[1],a=s.setOverflowX,o=void 0===a?!0:a,r=s.setOverflowY,l=void 0===r?!0:r;if(t&&t.nodeName&&"TEXTAREA"===t.nodeName&&!t.hasAttribute("data-autosize-on")){var d=null,u="hidden",c=function(e){window.removeEventListener("resize",n),t.removeEventListener("input",n),t.removeEventListener("keyup",n),t.removeAttribute("data-autosize-on"),t.removeEventListener("autosize:destroy",c),Object.keys(e).forEach(function(i){t.style[i]=e[i]})}.bind(t,{height:t.style.height,resize:t.style.resize,overflowY:t.style.overflowY,overflowX:t.style.overflowX,wordWrap:t.style.wordWrap});t.addEventListener("autosize:destroy",c),"onpropertychange"in t&&"oninput"in t&&t.addEventListener("keyup",n),window.addEventListener("resize",n),t.addEventListener("input",n),t.addEventListener("autosize:update",n),t.setAttribute("data-autosize-on",!0),l&&(t.style.overflowY="hidden"),o&&(t.style.overflowX="hidden",t.style.wordWrap="break-word"),e()}}function n(t){if(t&&t.nodeName&&"TEXTAREA"===t.nodeName){var e=document.createEvent("Event");e.initEvent("autosize:destroy",!0,!1),t.dispatchEvent(e)}}function s(t){if(t&&t.nodeName&&"TEXTAREA"===t.nodeName){var e=document.createEvent("Event");e.initEvent("autosize:update",!0,!1),t.dispatchEvent(e)}}var a=null;"undefined"==typeof window||"function"!=typeof window.getComputedStyle?(a=function(t){return t},a.destroy=function(t){return t},a.update=function(t){return t}):(a=function(t,e){return t&&Array.prototype.forEach.call(t.length?t:[t],function(t){return i(t,e)}),t},a.destroy=function(t){return t&&Array.prototype.forEach.call(t.length?t:[t],n),t},a.update=function(t){return t&&Array.prototype.forEach.call(t.length?t:[t],s),t}),e.exports=a});var InputField=new Class({Implements:[Events,Options,Validations],options:{required:!0,pattern:null,flashMessage:!0,capitalize:!1,regex:null,show_error_text:!0,name_attribute:"data-field",pattern_attribute:"data-pattern",input_tag_attribute:"data-field-type",required_attribute:"data-field-required",label_selector:"[data-field-label]",regex_failure_message:"Input Invalid",required_failure_message:"Required",tooltip_trigger_selector:"[data-tooltip-trigger]",tooltip_selector:"[data-tooltip]"},initialize:function(t,e){this.setOptions(e),this.root_el=t,this.name=this.root_el.get(this.options.name_attribute),this.options.pattern=this.root_el.get(this.options.pattern_attribute)||this.options.pattern,this.input_tag=this.root_el.get(this.options.input_tag_attribute),this.input_el=this.root_el.getElement(this.input_tag),this.options.required="false"===this.root_el.get(this.options.required_attribute)?!1:!0,this.label_el=this.root_el.getElement(this.options.label_selector),this.tooltip_trigger_el=this.root_el.getElement(this.options.tooltip_trigger_selector),this.tooltip_el=this.root_el.getElement(this.options.tooltip_selector),this.tooltip_trigger_el&&this.tooltip_el&&this.tooltip_trigger_el.addEvent("click",function(t){t.stopPropagation(),this.tooltip_el.removeClass("hide").addClass("show"),document.addEvent("click",function(){this.tooltip_el.removeClass("show").addClass("hide"),document.removeEvents("click")}.bind(this))}.bind(this)),this.input_el.addEvents({change:this._onInputChange.bind(this),input:this._onInputInput.bind(this),focus:this._onInputFocus.bind(this),blur:this._onInputBlur.bind(this)}),this.default_option_el=this.root_el.getElement("option[disabled][selected]:first-of-type"),this.default_option_el&&(this.default_option_text=this.default_option_el.get("text")),"textarea"===this.input_tag&&autosize(this.input_el),this.getValue()&&(this.undisplayError()._onInputChange(),this.default_value=this.getValue()),this.options.pattern&&this.setPattern(this.options.pattern),this.options.required&&this.addValidation(this._checkRequired.bind(this)),this.options.regex&&this.addValidation(this._checkRegex.bind(this))},getValue:function(){return this.input_el.get("value")},setValue:function(t){return this.input_el.set("value",t),this.undisplayError()._onInputChange(),this},clearValue:function(){return this.setValue(""),this.root_el.removeClass("active"),this},setPattern:function(t){return this.input_el.set("pattern",t),this.setOptions({pattern:t}),this},setLabel:function(t){return this.label_el.set("text",t),this},setRegex:function(t){return"string"==typeof t&&(t=new RegExp(t)),this.setOptions({regex:t}),this.addValidation(this._checkRegex.bind(this)),this},replaceOptionEls:function(t){return"select"!==this.input_tag?!1:(this.input_el.empty(),this.addOptionEl(this.default_option_text||"","",{disabled:"disabled",selected:"selected"}),_.each(t,function(t,e){var i={selected:this.default_value===t};this.addOptionEl(e,t,i)}.bind(this)),delete this.default_value,this)},updateOptionEls:function(t){return"select"!==this.input_tag?!1:(_.each(t,function(t){this.updateOptionEl(t.text,t.value,t.other_properties)}.bind(this)),this)},getOptionEls:function(){return"select"!==this.input_tag?!1:this.input_el.getElements("option")},findOptionEl:function(t){return"select"!==this.input_tag?!1:_.find(this.getOptionEls(),function(e){return e.get("value")===t})},addOptionEl:function(t,e,i){if("select"!==this.input_tag)return!1;var n=_.extend({text:t,value:e},i);return this.input_el.adopt(new Element("option",n)),this},removeOptionEl:function(t){return"select"!==this.input_tag?!1:(this.findOptionEl(t).destroy(),this)},updateOptionEl:function(t,e,i){if("select"!==this.input_tag)return!1;var n=this.findOptionEl(e),s=_.extend({text:t,value:e},i);return n.set(s),this},_onValid:function(t,e,i){this.undisplayError(),_.isFunction(i)&&i(t,e)},_onInvalid:function(t,e,i){this.displayError(t),_.isFunction(i)&&i(t)},displayError:function(t){return this.root_el.addClass("error"),this.options.show_error_text&&(this.error_msg_el?this.error_msg_el.set("text","("+t+")"):(this.error_msg_el=new Element("span.error-message",{text:"("+t+")"}),this.label_el.adopt(this.error_msg_el))),this},undisplayError:function(){return this.root_el.removeClass("error"),this.error_msg_el&&this.error_msg_el.remove(),this},_onInputChange:function(){return this.root_el.addClass("active"),this.fireEvent("change",this.getValue()),this},_onInputInput:function(){return this.options.capitalize&&this.input_el.set("value",this.input_el.get("value").toUpperCase()),this.undisplayError().fireEvent("input",this.getValue()),this},_onInputFocus:function(){return this.root_el.addClass("active"),this.fireEvent("focus"),this},_onInputBlur:function(){return this.input_el.get("value")||this.default_option_text||this.root_el.removeClass("active"),this.fireEvent("blur").validate(),this},_checkRequired:function(t){var e=this.input_el.get("value");e?t():t(this.options.required_failure_message)},_checkRegex:function(t){var e=this.input_el.get("value");""===e||!this.options.regex||this.options.regex.test(e)?t():t(this.options.regex_failure_message)},enable:function(){this.root_el.removeClass("disabled"),this.input_el.set("disabled","")},disable:function(){this.root_el.addClass("disabled"),this.input_el.set("disabled","disabled")}}),Harrys=Harrys||{},Form=new Class({Implements:[Events,Options,Validations],options:{name_attribute:"data-form",field_selector:"[data-field]"},initialize:function(t,e){this.setOptions(e),this.root_el=t,this.name=this.root_el.get(this.options.name_attribute),this.fields=this._setupFields(),this.addValidation(this._checkFields.bind(this))},_setupFields:function(){var t={};return _.each(this.root_el.getElements(this.options.field_selector),function(e){var i=new InputField(e);i.addEvents({change:function(){this.fireEvent("change",i.name)}.bind(this)}),t[i.name]=i}.bind(this)),t},getValue:function(){return _.reduce(this.fields,function(t,e,i){return t[i]=e.getValue(),t},{})},setValue:function(t){return _.each(this.fields,function(e,i){t[i]&&e.setValue(t[i])}),this},clearValue:function(){return _.each(this.fields,function(t){t.clearValue()}),this},_checkFields:function(t){async.each(_.values(this.fields),function(t,e){t.validate(function(t){e(t)})},function(e){e?t(e):t()})},show:function(){this.root_el.addClass("show").removeClass("hide")},hide:function(){this.root_el.addClass("hide").removeClass("show")}}),Harrys=Harrys||{},AddressForm=new Class({Extends:Form,options:{name_attribute:"data-address-form"},initialize:function(t,e){this.parent(t,e),this.addValidation(this._checkProvincePostalCode.bind(this)),this.fields.country&&this.fields.country.addEvent("change",this._onCountryChange.bind(this)),this.fields.zip&&this.fields.zip.addEvent("change",this._onZipChange.bind(this)),this.fields.telephone&&this.fields.telephone.addValidation(function(t){var e=this.input_el.get("value");e=e.replace(/\D/g,""),10===e.length?t(null,{success:!0}):e.length<10?t(I18n.t("AddressForm.errors.phone_number_too_short")):e.length>15&&t(I18n.t("AddressForm.errors.phone_number_too_long"))}.bind(this.fields.telephone)),this.fields.address_line_1.addEvent("change",this._checkForPOBox.bind(this)),this.fields.address_line_2.addEvent("change",this._checkForPOBox.bind(this)),this.fields.state.addEvent("change",this._checkForPOBox.bind(this)),this.is_po_box=this._isPoBox()},_onCountryChange:function(t){var e=Harrys.COUNTRIES[t];e.states=Object.map(Harrys.COUNTRIES[t].states,function(t,e){return e}),this.fields.zip.setPattern(e.zip_pattern).setRegex(Harrys.zip_format(t)).setLabel(e.zip_label),this.fields.state.replaceOptionEls(e.states).setLabel("US"===t?"State":"Province/Territory")},_onZipChange:function(t){this.autocomplete_service=this.autocomplete_service||new google.maps.places.AutocompleteService,this.places_service=this.places_service||new google.maps.places.PlacesService(new Element("div")),this.autocomplete_service.getPlacePredictions({input:t,types:["geocode"]},function(t,e){this.places_service.getDetails({placeId:t[0].place_id},function(t,e){var i=_.find(t.address_components,function(t){return _.contains(t.types,"locality")}),n=_.find(t.address_components,function(t){return _.contains(t.types,"administrative_area_level_1")});i&&this.fields.city.setValue(i.long_name),n&&this.fields.state.setValue(n.short_name)}.bind(this))}.bind(this))},_isPoBox:function(){return this._isApoFpo()?!0:Harrys.PO_BOX_REGEX.test(this.fields.address_line_1.getValue())||Harrys.PO_BOX_REGEX.test(this.fields.address_line_2.getValue())},_checkForPOBox:function(t){this._setPoBox(this._isPoBox())},_setPoBox:function(t){var e=this.is_po_box;e!=t&&(this.is_po_box=t,this.fireEvent("po_box_change"))},_isApoFpo:function(){return _.contains(Harrys.APO_FPO_CODES,this.fields.state.getValue())},getValue:function(){var t=_.reduce(this.fields,function(t,e,i){return t[i]=e.getValue(),t},{});return t.country_full=t.country?Harrys.COUNTRIES[t.country].full_name:"",t.is_po_box=this._isPoBox(),t},_checkProvincePostalCode:function(t){var e=this.getValue(),i=e.state,n=e.zip;Harrys.CANADA_POSTAL_PREFIXES[i],n[0];"CA"!=e.country||_.contains(Harrys.CANADA_POSTAL_PREFIXES[i],n[0])?t():(this.fields.state.displayError(I18n.t("AddressForm._checkProvincePostalCode.ca_postal_code_mismatch")),this.fields.zip.displayError(I18n.t("AddressForm._checkProvincePostalCode.ca_province_mismatch")),t(I18n.t("AddressForm._checkProvincePostalCode.ca_postal_code_province_mismatch")))}}),InputEventCompatibility={isCompatible:function(){return"safari"===Browser.name&&_.contains([1,2,3,4,5,6],Browser.version)?!1:!0}},Harrys=Harrys||{},PaymentForm=new Class({Extends:Form,options:{name_attribute:"data-payment-form"},card_data:[{type:"visa",detection_regex:/^4/,template_regex:/^(\d{0,4})(\d{0,4})(\d{0,4})(\d{0,4})\d*/,template_output:"$1 $2 $3 $4"},{type:"mastercard",detection_regex:/^5[1-5]/,template_regex:/^(\d{0,4})(\d{0,4})(\d{0,4})(\d{0,4})\d*/,template_output:"$1 $2 $3 $4"},{type:"amex",detection_regex:/^3[47]/,template_regex:/^(\d{0,4})(\d{0,6})(\d{0,5})\d*/,template_output:"$1 $2 $3"},{type:"discover",detection_regex:/^6(?:011|5[0-9]{2})/,template_regex:/^(\d{0,4})(\d{0,4})(\d{0,4})(\d{0,4})\d*/,template_output:"$1 $2 $3 $4"},{type:"default",template_regex:/^(\d{0,4})(\d{0,4})(\d{0,4})(\d{0,4})\d*/,template_output:"$1 $2 $3 $4"}],initialize:function(t,e){this.parent(t,e),this.addValidation(this._checkExpirationDate.bind(this)),this.fields.card_number&&this.fields.card_number.addEvent("input",this._onCardNumberInput.bind(this)).addValidation(this._checkLuhn.bind(this.fields.card_number)).root_el.getElement(".field-icons").adopt(new Element("div.card-type")),_.each(this.fields,function(t){t.setOptions({show_error_text:!1})})},_checkExpirationDate:function(t){var e=this.fields.month.getValue().toInt(),i=this.fields.year.getValue().toInt(),n=moment();i===n.year()&&e<n.month()+1?(this.fields.month.displayError(I18n.t("PaymentForm._checkExpirationDate.error")),this.fields.year.displayError(I18n.t("PaymentForm._checkExpirationDate.error")),t(I18n.t("PaymentForm._checkExpirationDate.error"))):t()},_checkLuhn:function(t){var e=this.input_el.get("value"),i=0,n=0,s=!1;e=e.replace(/\D/g,"");for(var a=e.length-1;a>=0;a--){var o=e.charAt(a);n=parseInt(o,10),s&&(n*=2)>9&&(n-=9),i+=n,s=!s}i%10===0?t(null,{success:!0}):t("Invalid Input")},_onCardNumberInput:function(t){InputEventCompatibility.isCompatible()&&this._formatCardNumber(t),this._displayCardType(t)},_formatCardNumber:function(t){if(t){t=t.replace(/\D/g,"");var e=this._findCardData(t),i=t.replace(e.template_regex,e.template_output);i=i.replace(/\D*$/,"");var n=this.fields.card_number.input_el.selectionStart,s=this.fields.card_number.input_el.selectionEnd,a=i.length-this.fields.card_number.getValue().length;this.fields.card_number.setValue(i),this.selectionStart=n+a,this.selectionEnd=s+a,this.fields.card_number.input_el.selectionStart=this.selectionStart,this.fields.card_number.input_el.selectionEnd=this.selectionEnd,setTimeout(function(){this.fields.card_number.input_el.setSelectionRange(this.selectionStart,this.selectionEnd)}.bind(this),0)}},_findCardData:function(t){t=t.replace(/\D/g,"");var e=_.find(this.card_data,function(e){return t.test(e.detection_regex)});return e=e||_.findWhere(this.card_data,{type:"default"})},_displayCardType:function(t){var e=this._findCardData(t);"default"!==e.type?this.fields.card_number.root_el.getElement(".card-type").addClass(e.type):_.each(this.card_data,function(t){this.fields.card_number.root_el.getElement(".card-type").removeClass(t.type)}.bind(this))}}),Radio=new Class({Implements:[Events,Options],options:{option_selector:"label.field",input_selector:'input[type="radio"]',value_attribute:"data-value"},initialize:function(t,e){this.setOptions(e),this.root_el=t,this.option_els=this.root_el.getElements(this.options.option_selector),_.each(this.option_els,function(t){var e=t.getElement(this.options.input_selector);e.addEvent("change",function(){this.fireEvent("change"),this._onChange()}.bind(this))}.bind(this))},getValue:function(){return this.getSelectedOptionEl().get(this.options.value_attribute)},setValue:function(t){return this.findOptionEl(function(e,i){return i.get("value")===t}).set("checked",!0),this},getSelectedOptionEl:function(){return this.findOptionEl(function(t,e){return e.get("checked")})},findOptionEl:function(t){return _.find(this.option_els,function(e){var i=e.getElement(this.options.input_selector);return t(e,i)}.bind(this))},filterOptionEls:function(t){return _.filter(this.option_els,function(e){var i=e.getElement(this.options.input_selector);return t(e,i)}.bind(this))},_onChange:function(){}}),Harrys=Harrys||{},ShippingClassRadio=new Class({Extends:Radio,initialize:function(t){this.parent(t),this.updating_el=this.root_el.getElement(".updating")},getClassData:function(){var t=this.getValue();return _.find(Harrys.SHIPPING_OPTIONS,function(e){return e.id.toString()===t.toString()})},updateOptions:function(t){this._requestAllowedOptions(t)},_requestAllowedOptions:function(t){this.updating_el.show();var e=new SignedRequest.JSON({url:"/api/v1/OrderService/allowed_shipping_classes",method:"post",data:t,onSuccess:function(t){t.success?this._onSuccess(t.data):this._onError(t.errors)}.bind(this),onFailure:this._onFailure.bind(this),onComplete:function(t){this.updating_el.hide()}.bind(this)});e.send()},_onSuccess:function(t){var e=t.shipping_classes;e.length?this.switchVisibleOptions(e):modal.open(function(t,e){t||(window.location.href="/cart")})},_onError:function(t){new Flash(t,"")},_onFailure:function(t){new Flash("","")},switchVisibleOptions:function(t){var e=this.getSelectedOptionEl();_.each(this.option_els,function(t){t.removeClass("show").addClass("hide")}),_.each(t,function(t){this.findOptionElByOption(t).removeClass("hide").addClass("show")}.bind(this)),e.hasClass("hide")&&this.findOptionEl(function(t,e){return t.hasClass("show")}).getElement(this.options.input_selector).set("checked",!0),this.fireEvent("change")},findOptionElByOption:function(t){return this.findOptionEl(function(e,i){return i.get("value").toString()===t.id.toString()})}}),Harrys=Harrys||{},ShippingAsBillingRadio=new Class({Extends:Radio,address_template:_.template("<%= name %><br><%= address_line_1 %> <%= address_line_2 %><br><%= city %>, <%= state %>, <%= zip %><br><%= country_full %><br>"),address_data:{},initialize:function(t,e){this.parent(t,e)},getData:function(){return this.address_data},updateAddress:function(t){var e=this.findOptionEl(function(t,e){return"same"===e.get("value")}),i=e.getElement(".field-subtitle");return i.set("html",this.address_template(t)),this.address_data=t,this}}),Modal=new Class({Implements:[Events,Options],options:{frame_selector:"[data-modal-frame]",cancel_selector:"[data-modal-cancel]",continue_selector:"[data-modal-continue]",content_selector:"[data-modal-content]",title_text:"Here is a message you need to deal with.",cancel_text:"No",continue_text:"Yes",cancel_button:"true",continue_button:"true",modal_class:""},template:_.template('<div class="modal modal-background <%= modal_class %> hide"><div class="modal-frame" data-modal-frame><span class="modal-cancel" data-modal-cancel></span><p class="modal-title"><%= title_text %></p><div class="modal-content" data-modal-content><%= this.content_template(obj) %></div><% if (cancel_button!=="false") { %><button class="medium sentimental-blue" data-modal-cancel><%= cancel_text %></button><% } %><% if (continue_button!=="false") { %><button class="medium blue" data-modal-continue><%= continue_text %></button><% } %></div></div>'),content_template:_.template(""),initialize:function(t){this.setOptions(t),this.root_el=this.buildEls()[0],this.root_el.inject(document.getElement("body")),this.frame_el=this.root_el.getElement(this.options.frame_selector),this.cancel_els=_.map(this.root_el.getElements(this.options.cancel_selector),function(t){return t.addEvent("click",function(){this.cancel()}.bind(this)),t}.bind(this)),this.continue_els=_.map(this.root_el.getElements(this.options.continue_selector),function(t){return t.addEvent("click",function(){this["continue"]()}.bind(this)),t}.bind(this)),this.content_el=this.root_el.getElement(this.options.content_selector)},buildEls:function(){return Elements.from(this.template(this.options))},open:function(t){return this.callback=t,this.root_el.removeClass("hide").addClass("show"),this},close:function(t,e){return this.callback&&this.callback(t,e),this.callback=null,this.root_el.removeClass("show").addClass("hide"),this},cancel:function(t){t=t||!0,this.close(t,null)},"continue":function(t){this.close(null,t)},hideContinueEls:function(){return _.each(this.continue_els,function(t){t.hide()}),this},hideCancelEls:function(){return _.each(this.cancel_els,function(t){t.hide()}),this},showContinueEls:function(){return _.each(this.continue_els,function(t){t.show()}),this},showCancelEls:function(){return _.each(this.cancel_els,function(t){t.show()}),this}}),AddressNotFoundModal=new Class({Extends:Modal,options:{title_text:"We couldn't find that<br> address, please confirm<br> your shipping address.",continue_text:"Continue",cancel_button:"false",modal_class:"address-not-found",radio_options:[{id:"form_address_not_found_ignore",field_class:"full-address-radio show",value:"ignore",name:"address_not_found",is_default:!0,title:"Use existing address",subtitle:""},{id:"form_address_not_found_change",field_class:"full-address-radio show",value:"change",name:"address_not_found",is_default:!1,title:"Use suggested address",subtitle:""}]},content_template:_.template('<div class="group"><% for (var i=0;i<radio_options.length;i++) { %><%= this.radio_template(radio_options[i]) %><% } %></div>'),radio_template:_.template('<label for="<%= id %>" class="field <%= field_class %>" data-value="<%= value %>"><input type="radio" id="<%= id %>" name="<%= name %>" value="<%= value %>" <% if (is_default) { %> checked <% } %>><div class="field-text"><span class="field-title"><%= title %></span><span class="field-subtitle"><%= subtitle %></span></div><div class="field-icons"><span class="radio"></span></div></label>'),address_template:_.template("<%= address_line_1 %><br><% if (address_line_2) { %><%= address_line_2 %><br><% } %><%= city %>, <%= state %> <%= zip %><br>"),initialize:function(t){this.parent(t)},updateOptions:function(t){return this.address_data=t,_.each(t,function(t,e){var i=this.root_el.getElement('[data-value="'+e+'"]'),n=i.getElement(".field-subtitle");n.set("html",this.address_template(t))}.bind(this)),this},"continue":function(t){var e=this.root_el.getElements('input[type="radio"]'),i=_.find(e,function(t){return t.checked}),n=i.get("value");t={address:this.address_data[n]},this.close(null,t)}}),ProductUnavailableModal=new Class({Extends:Modal,options:{title_text:"The following products are not currently available in your country. They will be removed from your cart.",continue_text:"Continue with Checkout",cancel_text:"Return to Shopping",modal_class:"product-unavailable"},content_template:_.template('<ul class="products"></ul>'),cart_item_template:_.template("<strong><%= name %></strong> - <span><%= customizations %></span>"),cart_items:[],initialize:function(t){this.parent(t)},updateCartItems:function(t){this.cart_items=t;var e=this.root_el.getElement("ul.products");return e.empty(),_.each(this.cart_items,function(t){var i=t.product,n=i.properties,s=t.customizations,a=[];n.color&&"Chrome"!==n.color&&a.push(n.color),n.pack_size&&a.push(n.pack_size+" Pack"),s.engraving&&a.push(s.engraving),s.secondary_engraving&&a.push(s.secondary_engraving),s.recipient_email&&a.push(s.recipient_email);var o={name:i.name,customizations:a.join(", ")},r=new Element("li.product",{html:this.cart_item_template(o)});e.adopt(r)}.bind(this)),this},cancel:function(t){_.each(this.cart_items,function(t){Harrys.cart.setQuantity(t.key,0)}),Harrys.warn_on_leave=!1,window.location="/products"},"continue":function(t){_.each(this.cart_items,function(t){Harrys.cart.setQuantity(t.key,0)}),Harrys.warn_on_leave=!1,window.location.reload(!0)}}),GiftingModal=new Class({Extends:Modal,Implements:[Validations],options:{gift_notecards:[],field_selector:"[data-field]",frame_selector:".swipe-frame",options_selector:".options",dot_selector:".dot[data-value]"},template:_.template('<div class="modal modal-background gifting hide"><div class="modal-frame" data-modal-frame><span class="modal-cancel" data-modal-cancel>Close</span><div class="group show no-border"><h2 class="group-title">Front of Card</h2><p class="group-subtitle">Note cards are complimentary.</p><img src="<%= gift_notecard.image_path %>"></div><div class="group show"><h2 class="group-title">Add Details</h2><%= this.text_input_template({ form_name: "gifting", name: "gift[to_name]", label: "To", required: "true" }) %><%= this.text_input_template({ form_name: "gifting", name: "gift[from_name]", label: "From", required: "true" }) %><%= this.text_input_template({ form_name: "gifting", name: "gift[to_email]", label: "Recipient\'s Email (Optional)", required: "false", tooltip: { kind: "info", body: "" } }) %></div><div class="group show"><h2 class="group-title">Add Message</h2><%= this.textarea_input_template({ form_name: "gifting", name: "gift[message]", label: "Type your message here...", required: "true" }) %></div><button class="medium blue" data-modal-continue>Add Gift Message</button></div></div>'),text_input_template:_.template('<div class="field" data-field="<%= name %>" data-field-type="input" data-field-required="<%= required %>"><div class="field-text"><label class="field-label" for="<%= form_name %>_<%= name %>" data-field-label><%= label %></label><input class="field-value" id="<%= form_name %>_<%= name %>" name="<%= name %>" type="text"></div><div class="field-icons"></div></div>'),textarea_input_template:_.template('<div class="field" data-field="<%= name %>" data-field-type="textarea" data-field-required="<%= required %>"><div class="field-text"><label class="field-label" for="<%= form_name %>_<%= name %>" data-field-label><%= label %></label><textarea class="field-value" id="<%= form_name %>_<%= name %>" name="<%= name %>"></textarea></div><div class="field-icons"></div></div>'),initialize:function(t){this.parent(t),this.fields=this._setupFields(),this.addValidation(this._checkFields.bind(this))},_setupFields:function(){var t={};return _.each(this.root_el.getElements(this.options.field_selector),function(e){var i=new InputField(e);i.addEvents({change:function(){this.fireEvent("change",i.name)}.bind(this)}),t[i.name]=i}.bind(this)),t},_checkFields:function(t){async.each(_.values(this.fields),function(t,e){t.validate(function(t){e(t)})},function(e){e?t(e):t()})},getValue:function(){return _.reduce(this.fields,function(t,e,i){return t[i]=e.getValue(),t},{card_id:this.options.gift_notecard.id})},"continue":function(t){t=t||{},this.validate(function(e){e||(t.data=this.getValue(),this.close(null,t))}.bind(this))}}),GiftingSection=new Class({Implements:[Options,Events],options:{gift_show_selector:'[data-gifting-show="gift"]',no_gift_show_selector:'[data-gifting-show="no-gift"]',field_selector:"[data-field-name]",field_name_attribute:"data-field-name",remove_gift_selector:'[data-gifting-action="remove"]'},initialize:function(t,e){this.setOptions(e),this.root_el=t,this.gift_show_els=this.root_el.getElements(this.options.gift_show_selector),this.no_gift_show_els=this.root_el.getElements(this.options.no_gift_show_selector),this.field_els=this.root_el.getElements(this.options.field_selector),this.remove_gift_els=this.root_el.getElements(this.options.remove_gift_selector),this.active=!1,this.data={},_.each(this.remove_gift_els,function(t){t.addEvent("click",function(){this.activateNoGiftView()}.bind(this))}.bind(this))},updateFields:function(t){return this.data=t,_.each(this.field_els,function(e){var i=e.get(this.options.field_name_attribute);e.set("text",t[i])}.bind(this)),this},activateNoGiftView:function(){return this.active=!1,_.each(this.gift_show_els,function(t){t.removeClass("show").addClass("hide")}),_.each(this.no_gift_show_els,function(t){t.removeClass("hide").addClass("show")}),this},activateGiftView:function(){return this.active=!0,_.each(this.gift_show_els,function(t){t.removeClass("hide").addClass("show")}),_.each(this.no_gift_show_els,function(t){t.removeClass("show").addClass("hide")}),this}}),Details=new Class({Implements:[Events,Options],options:{field_selector:"[data-field]",field_name_attribute:"data-field",edit_selector:'[data-details-action="edit"]',section_selector:"[data-details-section]",section_name_attribute:"data-details-section"},initialize:function(t,e){this.setOptions(e),this.root_el=t,this.section_els=this.root_el.getElements(this.options.section_selector),this.edit_els=this.root_el.getElements(this.options.edit_selector),this.enableEditEls()},updateFields:function(t){_.each(this.section_els,function(e){var i=e.get(this.options.section_name_attribute);t[i]&&_.each(e.getElements(this.options.field_selector),function(e){var n=e.get(this.options.field_name_attribute);t[i][n]?(t[i][n]="economy-free"===t[i][n]?"economy":t[i][n],e.set("text",String.from(t[i][n]).capitalize()),e.show()):e.hide()}.bind(this))}.bind(this))},disableEditEls:function(){return _.each(this.edit_els,function(t){t.removeEvents("click")}),this},enableEditEls:function(){return _.each(this.edit_els,function(t){t.addEvent("click",this._onEditElClick.bind(this))}.bind(this)),this},_onEditElClick:function(){this.fireEvent("edit")}}),CheckoutSummary=new Class({Implements:[Events,Options],options:{row_selector:"[data-row]",row_name_attribute:"data-row",field_selector:"[data-field]",field_name_attribute:"data-field",row_hide_if_attribute:"data-row-hide-if",field_replace_zero_with_attribute:"data-field-replace-zero-with",currency_symbol:"$"},initialize:function(t,e){this.setOptions(e),this.root_el=t,this.row_els=this.root_el.getElements(this.options.row_selector),this.field_els=this.root_el.getElements(this.options.field_selector)},update:function(t){return _.each(t,function(t,e){var i,n=this.findFieldElByName(e),s=this.findRowElByName(e),a=this.numberToCurrency(t);n&&(i=n.get(this.options.field_replace_zero_with_attribute),i&&0===t.toInt()&&(a=i),n.set("text",a));var o;s&&(o=s.get(this.options.row_hide_if_attribute),o&&o.toInt()===t.toInt()?s.hide():s.show())}.bind(this)),this},findFieldElByName:function(t){return _.find(this.field_els,function(e){return e.get(this.options.field_name_attribute)===t}.bind(this))},findRowElByName:function(t){return _.find(this.row_els,function(e){return e.get(this.options.row_name_attribute)===t}.bind(this))},numberToCurrency:function(t){return this.options.currency_symbol+t.round(2).toFixed(2)}}),CouponField=new Class({Extends:InputField,options:{required:!1,apply_action_selector:'[data-coupon-action="apply"]',remove_action_selector:'[data-coupon-action="remove"]',checkmark_selector:".checkmark"},state:"default",initialize:function(t,e){this.parent(t,e),this.discount=new Discount;var i=this.root_el.getElement(this.options.apply_action_selector);this.apply_action_button=new Button(i),this.apply_action_button.addEvent("click",this._onApplyActionClick.bind(this)),this.remove_action_el=this.root_el.getElement(this.options.remove_action_selector),this.remove_action_el.addEvent("click",this._onRemoveActionClick.bind(this)),this.checkmark_el=this.root_el.getElement(this.options.checkmark_selector),this.addValidation(this._checkCouponCode.bind(this)),this.getValue()&&this._onApplyActionClick()},_onApplyActionClick:function(){this.apply_action_button.disable(),this.validate(function(t,e){if(this.apply_action_button.enable(),t)new Flash(t),this._onRemoveActionClick();else{this._setValidState();var i=_.reduce(e,function(t,e){return e.amount&&(t.amount=e.amount.toFloat()),t},{});this.fireEvent("discount_change",i.amount)}}.bind(this))},_onRemoveActionClick:function(){this.clearValue(),this._checkCouponCode(function(){this._setDefaultState(),this.discount._unsave(),this.undisplayError(),this.fireEvent("discount_change",0)}.bind(this))},_setDefaultState:function(){this.apply_action_button.el.hide(),this.remove_action_el.hide(),this.checkmark_el.hide(),this.state="default"},_setActiveState:function(){this.apply_action_button.el.show(),this.remove_action_el.hide(),this.checkmark_el.hide(),this.state="active"},_setValidState:function(){this.apply_action_button.el.hide(),this.remove_action_el.show(),this.checkmark_el.setStyle("display","inline-block"),this.state="valid"},_onInputFocus:function(){return this.getValue()||this._setActiveState(),this.root_el.addClass("active"),this.fireEvent("focus"),this},_onInputBlur:function(){return this.getValue()&&"valid"!==this.state?this._setActiveState():"valid"===this.state?this._setValidState():this._setDefaultState(),
this.input_el.get("value")||this.default_option_text||this.root_el.removeClass("active"),this.fireEvent("blur"),this},_onInputInput:function(){return this._setActiveState(),this.options.capitalize&&this.input_el.set("value",this.input_el.get("value").toUpperCase()),this.undisplayError().fireEvent("input",this.getValue()),this},_checkCouponCode:function(t){var e=this.input_el.get("value");e?this.discount.check(e,t):t()}}),Harrys=Harrys||{},STARTING_PAGE_INDEX=0,COUNTRY_DEFAULT="US",BREADCRUMBS_SELECTOR="[data-breadcrumbs]",PAGES_SELECTOR="[data-page]",ADDRESS_FORMS_SELECTOR="[data-address-form]",PAYMENT_FORMS_SELECTOR="[data-payment-form]",SHIPPING_INFO_SELECTOR="[data-shipping-info-radio]",SHIPPING_CLASSES_SELECTOR="[data-shipping-classes]",ADDRESS_MODAL_SELECTOR='[data-modal="address-not-found"]',PRODUCT_MODAL_SELECTOR='[data-modal="product-unavailable"]',NEW_SHIPPING_GROUP_SELECTOR="[data-group-shipping-new]",BILLING_INFO_SELECTOR="[data-billing-info-radio]",SHIPPING_AS_BILLING_SELECTOR="[data-shipping-as-billing]",NEW_BILLING_GROUP_SELECTOR="[data-group-billing-new]",NEW_BILLING_ADDRESS_GROUP_SELECTOR="[data-group-billing-address-new]",SHIPPING_DETAILS_SELECTOR='[data-details="shipping"]',BILLING_DETAILS_SELECTOR='[data-details="billing"]',CHECKOUT_SUMMARY_SELECTOR="[data-checkout-summary]",PURCHASE_SELECTOR="[data-purchase]",PURCHASE_TOTAL_SELECTOR="[data-purchase-total]",GIFTING_MODAL_OPEN_SELECTOR='[data-modal-open="gifting-message"]',GIFTING_SELECTOR="[data-gifting]",COUPON_FIELD_SELECTOR='[data-field="coupon_code"]';window.addEvent("domready",init);
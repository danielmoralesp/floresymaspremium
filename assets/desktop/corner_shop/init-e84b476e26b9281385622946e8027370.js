var Harrys=Harrys||{},Modal=new Class({Implements:Events,initialize:function(t){this.root_el=t,this.frame_el=this.root_el.getElement(".frame"),this.close_el=this.root_el.getElement("span.close"),this.close_el.addEvent("click",function(){this.close(!0,!1)}.bind(this)),this.root_el.addEvent("click",function(){this.close(!0,!1)}.bind(this)),this.frame_el.addEvent("click",function(t){t.stopPropagation()})},open:function(){return this.root_el.show(),this},close:function(){return this.root_el.hide(),this}}),AddressModal=new Class({Extends:Modal,initialize:function(t){this.parent(t),this.message_el=this.root_el.getElement(".message"),this.suggestion_el=this.root_el.getElement(".suggestion"),this.ignore_button=new Button(this.root_el.getElement("button.ignore")),this.change_address_button=new Button(this.root_el.getElement("button.continue")),this.ignore_button.addEvent("click",function(){this.close(null,{success:!0})}.bind(this))},setupSuggestion:function(t){this.message_el.set("text",I18n.t("Modals.AddressModal.setupSuggestion"));var e={address_line_1:t.street1,address_line_2:t.street2||"",city:t.city,state:t.state,zip:t.zip,country:t.country||""};_.each(e,function(t,e){var s=this.suggestion_el.getElement('[data-field="'+e+'"]');s&&s.set("text",t)}.bind(this)),this.suggestion_el.show(),this.change_address_button.setText("Yes! Use this one instead"),this.change_address_button.removeEvents("click").addEvent("click",function(){this.fireEvent("use_suggestion",e),this.close(null,{success:!0})}.bind(this))},setupNotFound:function(){this.message_el.set("html",I18n.t("Modals.AddressModal.setupNotFound")),this.suggestion_el.hide(),this.change_address_button.setText("Fix Errors"),this.change_address_button.removeEvents("click").addEvent("click",function(){this.close(!0,!1)}.bind(this))},open:function(t,e){this.callback=e,t.returned_address?this.setupSuggestion(t.returned_address):this.setupNotFound(),this.root_el.show()},close:function(t,e){this.callback(t,e),this.callback=null,this.root_el.hide()}}),GiftModal=new Class({Extends:Modal,initialize:function(t){if(this.parent(t),this.active=!1,this.checks=[],this.step_one=this.root_el.getElement(".step.one"),this.step_two=this.root_el.getElement(".step.two"),this.card_els=this.root_el.getElements(".card"),this.back_el=this.root_el.getElement(".arrow.left"),this.inputs={to_name:new Input(this.root_el.getElement("input.to-name"),{required:!0,appendErrors:!0,flashMessage:!1}),from_name:new Input(this.root_el.getElement("input.from-name"),{required:!0,appendErrors:!0,flashMessage:!1}),message:new Textarea(this.root_el.getElement("textarea.message"),{required:!0,appendErrors:!0,flashMessage:!1}),to_email:new EmailInput(this.root_el.getElement("input.to-email"),{required:!1,appendErrors:!0,flashMessage:!1})},this.add_card_button=new Button(this.root_el.getElement("button.add-card")),_.each(this.card_els,function(t){t.addEvents({click:function(){this.chooseCard(t.get("data-id"),t.get("data-image"))}.bind(this),mouseenter:function(t){_.each(this.card_els,function(e){e!==t.target&&e.addClass("not-selected")})}.bind(this),mouseleave:function(){this.card_els.removeClass("not-selected")}.bind(this)})}.bind(this)),this.back_el.addEvent("click",function(){this.back()}.bind(this)),this.inputs.message.el.addEvent("input",function(){this.root_el.getElement(".counter").set("text",175-this.inputs.message.getValue().length)}.bind(this)),this.add_card_button.addEvent("click",function(){this.add_card_button.disable(),this.validate(function(t){this.add_card_button.enable(),t||(this.activate(),this.close())}.bind(this))}.bind(this)),this.checks.push(this._checkInputs.bind(this)),1===this.card_els.length){var e=this.card_els[0];this.chooseCard(e.get("data-id"),e.get("data-image"))}},back:function(){this.step_two.hide(),this.step_one.show()},validate:function(t){this.checks.length>0?async.auto(this.checks,t):t(null,{success:!0})},_checkInputs:function(t){var e=[];_.each(this.inputs,function(t){t.validate(function(t){t&&e.push(t)})}),e.length>0?t(_.uniq(e)):t(null,{success:!0})},chooseCard:function(t,e){this.id=t,this.image=e,this.step_one.hide(),this.step_two.show()},getGiftInfo:function(){var t={card_id:this.id,image:this.image};return _.each(this.inputs,function(e,s){t[s]=e.getValue()}),t},activate:function(){this.active=!0,this.fireEvent("active",this.getGiftInfo())},deactivate:function(){this.active=!1},isActive:function(){return this.active},close:function(){this.root_el.hide(),this.step_two.hide(),this.step_one.show()}}),TwoStepGiftModal=new Class({Extends:GiftModal,initialize:function(t){this.root_el=t,this.header_el=this.root_el.getElement(".header"),this.heading=this.header_el.getElement("h5"),this.back_el=this.header_el.getElement(".back"),this.heading.set("text","Which card would you like?"),this.parent(t),this.back_el.addEvent("click",function(){this.back()}.bind(this)),this.step_three=this.root_el.getElement(".step.three"),this.step_two_inputs={to_name:this.inputs.to_name,from_name:this.inputs.from_name,to_email:this.inputs.to_email},this.next_step_button=new Button(this.root_el.getElement("button.continue")),this.next_step_button.addEvent("click",function(){this.next_step_button.disable(),this.partialValidate(this.step_two_inputs,function(t){this.next_step_button.enable(),t||(this.step_two.hide(),this.step_three.show(),this.heading.set("text","Add Message"))}.bind(this))}.bind(this))},back:function(){this.step_two.isVisible()?(this.parent(),this.back_el.hide(),this.heading.set("text","Which card would you like?")):this.step_three.isVisible()&&(this.step_three.hide(),this.step_two.show(),this.heading.set("text","Add Details"))},partialValidate:function(t,e){async.auto([function(e){var s=[];_.each(t,function(t){t.validate(function(t){t&&s.push(t)})}),s.length>0?e(_.uniq(s)):e(null,{success:!0})}.bind(this)],e)},chooseCard:function(t,e){this.parent(t,e),this.back_el.show(),this.heading.set("text","Add Details")},getGiftInfo:function(){return info=this.parent(),info.image=info.image.replace("mobile/",""),info},close:function(){this.step_three.hide(),this.back_el.hide(),this.parent()}}),ProductUnavailableModal=new Class({Extends:Modal,initialize:function(t){this.parent(t),this.products_table=this.root_el.getElement("table.products"),this.return_button=this.root_el.getElement("button.return"),this.continue_button=this.root_el.getElement("button.continue")},_setup:function(t,e){this.products_table.empty().adopt(_.map(t,function(t){return this._productTemplate(t)}.bind(this))),this.return_button.removeEvents("click").addEvent("click",function(){_.each(t,function(t){Harrys.cart.setQuantity(t.key,0)}),Harrys.warn_on_leave=!1,window.location="/products"}),this.continue_button.removeEvents("click").addEvent("click",function(){_.each(t,function(t){Harrys.cart.setQuantity(t.key,0)}),Harrys.warn_on_leave=!1,window.location.reload(!0)}),e?this.continue_button.hide():this.continue_button.show()},_productTemplate:function(t){var e={};e.name=t.product.name;var s=[];t.product.color_slug&&"chrome"!==t.product.color_slug&&s.push(t.product.color),t.product.pack_size&&s.push(t.product.pack_size+" Pack"),t.customizations.engraving&&s.push(t.customizations.engraving),t.customizations.secondary_engraving&&s.push(t.customizations.secondary_engraving),t.customizations.recipient_email&&s.push(t.customizations.recipient_email),e.customizations=s.join(", "),e.quantity=t.quantity;var i=t.customizations.interval;return i&&(i/=30),e.interval=i?"Every "+i+" Month"+(i>1?"s":""):"",e.price="$"+t.product.price.toInt().toFixed(2),e.total="$"+(t.product.price*t.quantity).toInt().toFixed(2),Elements.from(_.template('<tr class="product"><td class="name"><strong><%= name %></stong><span><%= customizations %></span></td><td class="quantity">Qty: <%= quantity %></td><td class="interval"><%= interval %></td><td class="price"><%= price %></td><td class="total"><%= total %></td></tr>',e))},open:function(t,e,s){this.callback=s,this._setup(t,e),this.root_el.show()},close:function(t,e){this.callback&&this.callback(t,e),this.callback=null,this.root_el.hide()}}),ConfirmModal=new Class({Implements:[Events,Options],options:{message_text:"Are you sure you want to do that?",cancel_text:"No",continue_text:"Yes"},template:_.template('<div class="modal confirm background" style="display: none;"><div class="frame"><span class="close"></span><strong class="message"><%= message_text %></strong><% if (cancel_text) { %><button class="medium sentimental-blue cancel"><%= cancel_text %></button><% } %><% if (continue_text) { %><button class="medium blue continue"><%= continue_text %></button><% } %></div></div>'),initialize:function(t){this.setOptions(t),this.root_el=Elements.from(this.template(this.options))[0],this.frame_el=this.root_el.getElement(".frame"),this.close_el=this.root_el.getElement("span.close"),this.close_el.addEvent("click",function(){this.close(!0,!1)}.bind(this)),this.message_el=this.root_el.getElement(".message");var e=this.root_el.getElement("button.cancel");e&&(this.cancel_button=new Button(e));var s=this.root_el.getElement("button.continue");s&&(this.continue_button=new Button(s)),this.cancel_button&&this.cancel_button.addEvent("click",function(){this.close(!0)}.bind(this)),this.continue_button&&this.continue_button.addEvent("click",function(){this.close(null,{success:!0})}.bind(this))},open:function(t){this.callback=t,this.root_el.inject(document.getElement("body")).show()},close:function(t,e){this.callback(t,e),this.callback=null,this.root_el.hide().dispose()}}),CornershopModal=new Class({Extends:Modal,initialize:function(t){this.parent(t),this.triggers=$$(".squareTrigger"),this.overlay=$("body-overlay");var e=$$("html")[0];if(e.hasClass("ie8")||e.hasClass("ie9")){var s=$$(".phone")[0].get("text");return _.each(this.triggers,function(t){t.set("text","Call "+s)}),void 0}_.each(this.triggers,function(t){t.addEvent("click",this.open.bind(this))}.bind(this))},open:function(t){t.stopPropagation(),$(document.body).addClass("stop-scrolling"),this.overlay.show(),this.root_el.show(),$(document.body).addEvent("click",this.close.bind(this)),this.close_el.addEvent("click",this.close.bind(this))},close:function(){$("schedule-modal").hide(),this.overlay.hide(),$(document.body).removeClass("stop-scrolling")}});window.addEvent("domready",function(){var t=$("slideshow");if(t&&t.getElements("li").length){SlideShow.defineTransition("barbers",function(t){{var e=t.next,s=t.previous,i=s.getElement(".text"),n=e.getElement(".text"),o=(new Fx.Tween(i,{duration:250,property:"opacity",onStart:function(){n.setStyle("opacity",0)},onComplete:function(){n.fade("in")}}).start(1,0),s.getElement(".image")),a=e.getElement(".image");new Fx.Tween(o,{duration:250,property:"opacity",onStart:function(){a.setStyle("opacity",0)},onComplete:function(){a.fade("in")}}).start(1,0)}});var e=new SlideShow("slideshow",{transition:"barbers",delay:1e4,autoplay:!0,onComplete:function(){prevEl.getElement("h4").setStyle("opacity",1)}});t.addEvents({mouseover:function(){e.pause()},mouseout:function(){e.play()}});{$$(".barbers .arrow.left").addEvent("click",function(){e.show("previous"),e.pause(),t.removeEvents()}),$$(".barbers .arrow.right").addEvent("click",function(){e.show("next"),e.pause(),t.removeEvents()})}}var s=$("schedule-modal");s&&new CornershopModal(s)});
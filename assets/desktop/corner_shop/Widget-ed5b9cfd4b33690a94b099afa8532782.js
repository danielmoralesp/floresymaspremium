var LoginWall=new Class({Implements:Events,initialize:function(e){return this.container=e,this.root_el=this.container.getElementById("square-login"),this.square_widget=new SquareWidget($("square-widget")),Harrys.user.signedIn()?(this.showSquare(),void 0):(this.flash_area=this.root_el.getElement(".modal-flashes"),this.login_form=this.root_el.getElementById("login-form"),this.login_btn=new Button(this.login_form.getElement("button")),this.register_form=this.root_el.getElementById("register-form"),this.register_btn=new Button(this.register_form.getElement("button")),this.login_form.addEvent("submit",function(e){e.preventDefault(),this.login_btn.disable();var t=this.login_form.toQueryString().parseQueryString(),s=this.validateLoginForm(t);0===s.length?this.sendRequest("/users/sign_in.json",t):this.flashErrors(s)}.bind(this)),this.register_form.addEvent("submit",function(e){e.preventDefault(),this.register_btn.disable();var t=this.register_form.toQueryString().parseQueryString(),s=this.validateRegistrationForm(t);0===s.length?this.sendRequest("/users.json",t):this.flashErrors(s)}.bind(this)),void 0)},flashErrors:function(e){this.flash_area.empty(),this.root_el.getElements("input.error").removeClass("error"),this.login_btn.enable(),this.register_btn.enable(),"object"!=typeof e||e instanceof Array?"object"==typeof e&&_.each(e,function(e){var t=e.error||e;this.flash_area.appendChild(new Element("div",{"class":"error",html:t})),e.field&&this.root_el.getElementById(e.field).addClass("error")}.bind(this)):_.each(e,function(e,t){this.flash_area.appendChild(new Element("div",{"class":"error",html:t.capitalize()+" "+e}))}.bind(this))},validateLoginForm:function(e){var t=[];return""===e["user[email]"].trim()&&t.push({field:"user_email",error:"Email cannot be blank!"}),""===e["user[password]"]&&t.push({field:"user_password",error:"Password cannot be blank!"}),t},validateRegistrationForm:function(e){var t=[];return""===e["user[email]"].trim()&&t.push({field:"user_email_reg",error:"Email cannot be blank."}),""===e["user[password]"]&&t.push({field:"user_password_reg",error:"Password cannot be blank."}),""===e["user[confirm_password]"]&&t.push({field:"user_confirm_password_reg",error:"Confirm password cannot be blank."}),e["user[confirm_password]"]!==e["user[password]"]&&t.push({field:"user_password_reg",error:"Passwords do not match."}),t},sendRequest:function(e,t){new SignedRequest.JSON({url:e,method:"post",data:{user:{email:t["user[email]"],password:t["user[password]"]}},onSuccess:function(e){e.success?this.showSquare():this.flashErrors(e.errors)}.bind(this),onFailure:function(){this.flashErrors(["Oops, something went wrong. Please try again."])}.bind(this)}).send()},showSquare:function(){this.root_el.hide(),this.square_widget.openWidget()}}),SquareWidget=new Class({Implements:Events,square_widget_URL:"https://squareup.com/appointments/buyer/widget/e030d08e-cd88-4b33-a923-1d0077b73da1.js",initialize:function(e){this.container=e,this.square_widget_script=new Element("script"),this.square_widget_script.src=this.square_widget_URL},openWidget:function(){"test"!==Harrys.ENV&&this.container.appendChild(this.square_widget_script)}});window.addEvent("domready",function(){new LoginWall($("modal-content"))});